<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Asyncing Feeling about JavaScript Generators</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/css/app.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/assets/css/custom.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/assets/css/highlight.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=DM+Sans:400,400i,700,700i&display=swap" media="screen" />
    <link rel="stylesheet" type="text/css" href="/assets/css/fonts.css" media="screen" />

    

    <meta name="description" content="Async generators and async iteration are likely to ship before too long. Let’s investigate how async generators work and examine the challenges of using them." />
    <link rel="shortcut icon" href="/favicon.png" type="image/png" />
    <link rel="canonical" href="https://www.bignerdranch.com/blog/asyncing-feeling-about-javascript-generators/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://jonathanleemartin.com/blog/asyncing-feeling-about-javascript-generators/amp/" />
    
    <meta property="og:site_name" content="tl;dr" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Asyncing Feeling about JavaScript Generators" />
    <meta property="og:description" content="Async generator functions have arrived in JavaScript! Iterate over Stream-like data with a for-loop and even rewrite ReactiveX.js. Read on to see what comes .next()…" />
    <meta property="og:url" content="https://www.bignerdranch.com/blog/asyncing-feeling-about-javascript-generators/" />
    <meta property="article:published_time" content="2017-01-18T12:00:00.000Z" />
    <meta property="article:modified_time" content="2019-08-09T16:05:21.000Z" />
    <meta property="article:tag" content="JavaScript" />
    
    <meta property="article:publisher" content="https://www.facebook.com/yellowscale" />
    <meta property="article:author" content="https://www.facebook.com/yellowscale" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Asyncing Feeling about JavaScript Generators" />
    <meta name="twitter:description" content="Async generator functions have arrived in JavaScript! Iterate over Stream-like data with a for-loop and even rewrite ReactiveX.js. Read on to see what comes .next()…" />
    <meta name="twitter:url" content="https://www.bignerdranch.com/blog/asyncing-feeling-about-javascript-generators/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Jonathan Lee Martin" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="JavaScript" />
    <meta name="twitter:site" content="@nybblr" />
    <meta name="twitter:creator" content="@nybblr" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "tl;dr",
        "logo": {
            "@type": "ImageObject",
            "url": "https://jonathanleemartin.com/content/images/2019/08/logo.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Jonathan Lee Martin",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/6dc50195bf39376a9154e48d6b5df778?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://jonathanleemartin.com/author/jonathan/",
        "sameAs": [
            "https://jonathanleemartin.com/",
            "https://www.facebook.com/yellowscale",
            "https://twitter.com/nybblr"
        ]
    },
    "headline": "Asyncing Feeling about JavaScript Generators",
    "url": "https://jonathanleemartin.com/blog/asyncing-feeling-about-javascript-generators/",
    "datePublished": "2017-01-18T12:00:00.000Z",
    "dateModified": "2019-08-09T16:05:21.000Z",
    "keywords": "JavaScript",
    "description": "Async generator functions have arrived in JavaScript! Iterate over Stream-like data with a for-loop and even rewrite ReactiveX.js. Read on to see what comes .next()…",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://jonathanleemartin.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 2.27" />
    <link rel="alternate" type="application/rss+xml" title="tl;dr" href="" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-30173272-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-30173272-1');
</script>

    <script>
      const ghostHost = "https://jonathanleemartin.com"
    </script>
  </head>
  <body class="post-template tag-javascript">
    

<div class="main-wrap">
  
  <header class="m-header js-header">
  <div class="m-mobile-topbar" data-aos="fade-down">
    <button class="m-icon-button in-mobile-topbar js-open-menu" aria-label="Open menu">
      <span class="icon-menu"></span>
    </button>
      <a href="https://jonathanleemartin.com" class="m-logo in-mobile-topbar">
        <img src="/content/images/2019/08/logo.png" alt="tl;dr">
      </a>
    <button class="m-icon-button in-mobile-topbar js-open-search" aria-label="Open search">
      <span class="icon-search"></span>
    </button>
  </div>

  <div class="m-menu js-menu">
    <button class="m-icon-button outlined as-close-menu js-close-menu" aria-label="Close menu">
      <span class="icon-close"></span>
    </button>
    <div class="m-menu__main" data-aos="fade-down">
      <div class="l-wrapper">
        <div class="m-nav">
          <nav class="m-nav__left">
              
<ul role="menu">
  <li class="only-desktop" role="menuitem">
    <a href="https://jonathanleemartin.com" class="m-logo">
      <img src="/content/images/2019/08/logo.png" alt="tl;dr">
    </a>
  </li>
    <li class="nav-blog">
      <a href="https://jonathanleemartin.com/blog/">Blog</a>
    </li>
    <li class="nav-episodes">
      <a href="https://jonathanleemartin.com/tldr/">Episodes</a>
    </li>
    <li class="nav-youtube">
      <a href="https://www.youtube.com/channel/UCol-gOYBawJGqUn2AhwxhNg">YouTube</a>
    </li>
    <li class="nav-books">
      <a href="https://jonathanleemartin.com/books/">Books</a>
    </li>
  <li role="menuitem" class="js-submenu-option">
    <button class="m-icon-button in-menu-main more js-toggle-submenu" aria-label="Toggle submenu">
      <span class="icon-more"></span>
    </button>
    <div class="m-submenu js-submenu">
      <div class="l-wrapper in-submenu">
        <section class="m-recent-articles">
          <h3 class="m-submenu-title in-recent-articles">Recent articles</h3>
          <div class="js-recent-articles">
                <div>
                  <a href="/tldr/04-expressions/" class="m-recent-article">
                    <div class="m-recent-article__picture">
                      <div style="background-image: url(/content/images/size/w600/2019/08/04-expressions.png);"></div>
                    </div>
                    <h3 class="m-recent-article__title">04. Expressions</h3>
                    <span class="m-recent-article__date">August 5, 2019</span>
                  </a>
                </div>
                <div>
                  <a href="/tldr/03-policies/" class="m-recent-article">
                    <div class="m-recent-article__picture">
                      <div style="background-image: url(/content/images/size/w600/2019/08/03-policies.png);"></div>
                    </div>
                    <h3 class="m-recent-article__title">03. Policies</h3>
                    <span class="m-recent-article__date">August 5, 2019</span>
                  </a>
                </div>
                <div>
                  <a href="/tldr/02-router-pattern/" class="m-recent-article">
                    <div class="m-recent-article__picture">
                      <div style="background-image: url(/content/images/size/w600/2019/08/02-router.png);"></div>
                    </div>
                    <h3 class="m-recent-article__title">02. Router Pattern</h3>
                    <span class="m-recent-article__date">August 5, 2019</span>
                  </a>
                </div>
                <div>
                  <a href="/tldr/01-nested-ternaries/" class="m-recent-article">
                    <div class="m-recent-article__picture">
                      <div style="background-image: url(/content/images/size/w600/2019/08/01-nested-ternaries.png);"></div>
                    </div>
                    <h3 class="m-recent-article__title">01. Nested Ternaries</h3>
                    <span class="m-recent-article__date">August 5, 2019</span>
                  </a>
                </div>
          </div>
        </section>
        <section class="m-tags">
          <h3 class="m-submenu-title">Tags</h3>
            <ul>
                <li>
                  <a href="/tag/javascript/">JavaScript</a>
                </li>
                <li>
                  <a href="/tag/node/">Node</a>
                </li>
                <li>
                  <a href="/tag/react/">React</a>
                </li>
                <li>
                  <a href="/tag/web/">Web</a>
                </li>
                <li>
                  <a href="/tag/tldr/">tl;dr</a>
                </li>
            </ul>
        </section>
      </div>
    </div>
  </li>
</ul>

          </nav>
          <button class="m-icon-button in-menu-main js-open-search" aria-label="Open search">
            <span class="icon-search"></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>
  
  <header class="m-hero" data-aos="fade">
  </header>
  
  <main>
    <article>
      <div class="l-content">
        <div class="l-wrapper in-post js-aos-wrapper" data-aos="fade-up" data-aos-delay="300">
          <div class="l-post-content has-subscribe-form js-progress-content">
            <header class="m-heading">
              <h1 class="m-heading__title in-post">Asyncing Feeling about JavaScript Generators</h1>
              <div class="m-heading__meta">
                <a href="/tag/javascript/" class="m-heading__meta__tag">JavaScript</a>
                <span class="m-heading__meta__divider">&bull;</span>
                <span class="m-heading__meta__time">January 18, 2017</span>
              </div>
            </header>
            <div class="pos-relative js-post-content">
              <div class="m-share">
                <div class="m-share__content js-sticky">
                  <a href="https://www.facebook.com/sharer/sharer.php?u=https://jonathanleemartin.com/blog/asyncing-feeling-about-javascript-generators/" class="m-icon-button filled in-share" target="_blank" rel="noopener" aria-label="Facebook">
                    <span class="icon-facebook"></span>
                  </a>
                  <a href="https://twitter.com/intent/tweet?text=Asyncing%20Feeling%20about%20JavaScript%20Generators&url=https://jonathanleemartin.com/blog/asyncing-feeling-about-javascript-generators/" class="m-icon-button filled in-share" target="_blank" rel="noopener" aria-label="Twitter">
                    <span class="icon-twitter"></span>
                  </a>
                  <button class="m-icon-button filled in-share progress js-scrolltop" aria-label="Scroll to top">
                    <span class="icon-arrow-top"></span>
                    <svg>
                      <circle class="progress-ring__circle js-progress" stroke="#04aeee" fill="transparent" r="0" />
                    </svg>
                  </button>
                </div>
              </div>
              <!--kg-card-begin: markdown--><!--kg-card-begin: markdown--><p><small><em>This post first appeared on the <a href="https://www.bignerdranch.com/blog/asyncing-feeling-about-javascript-generators/">Big Nerd Ranch blog</a>.</em></small></p>
<p><em>Want the <strong>TL;DR</strong> version? <a href="https://gist.github.com/nybblr/3af62797052c42f7090b4f8614b5e157">Here’s a gist of all three examples</a>.</em></p>
<p><a href="https://github.com/tc39/proposal-async-iteration">Async generators and async iteration have arrived</a>! Err, they’ve reached <a href="https://tc39.github.io/process-document/">Stage 3</a>, which means they are likely to ship in a future version of JavaScript. Until then, you can enable Stage 3 proposals in <a href="https://babeljs.io/repl/#?presets=stage-3">Babel</a> to try them out in your own projects.</p>
<p>The web is essentially a decentralized app runtime, so subpar language additions have permanent consequences since future standards must remain backwards compatible. So for a feature to be accepted into the ECMAScript standard, it has to be incredibly compelling—it takes more than snazzy syntax or theoretical elegance for a feature to make the cut.</p>
<p>With that in mind, we should expect async generators and iteration to substantially influence how we architect our future code, yet address a contemporary problem. Let’s investigate how async generators work and examine the challenges of using them in “real” codebases.</p>
<h2 id="recaphowasyncgeneratorswork">Recap: How Async Generators Work</h2>
<p>In a nutshell, async generators are like regular generator functions, but they yield Promises. If you aren’t familiar with ES2015 generator functions, check out Chris Aquino’s <a href="/blog/generators-rick-astley-and-the-sequence-of-fibonacci/">blog</a>, then watch Jafar Husain’s excellent talk on <a href="https://www.youtube.com/watch?v=lil4YCCXRYc">Async Programming</a>.</p>
<p>To recap, regular generator functions are basically a cross between the <a href="https://en.wikipedia.org/wiki/Iterator_pattern">Iterator</a> and <a href="https://en.wikipedia.org/wiki/Observer_pattern">Observer</a> patterns. A generator is a pausable function that you can “step” through by calling <code>.next()</code>. You can pull a value out of a generator multiple times with <code>.next()</code>, or push a value into the same function multiple times with <code>.next(valueToPush)</code>. This dual interface allows you to imitate both an Iterator and Observer with the same syntax!</p>
<p>However, generators have a disadvantage: they must <em>immediately</em> (synchronously) return data when <code>.next()</code> is invoked. Put another way, the code that <em>consumes</em> the data by calling <code>.next()</code> is in control of data flow. This is fine when the generator can generate new data on demand, but generators are not a good fit for iterating over asynchronous (or <em>temporal</em>) data sources, where the source itself controls when the next chunk of data is available.</p>
<p>WebSocket messages are a good example of an <em>asynchronous</em> data source. If we had a list of all the messages we would ever receive, we could iterate over them synchronously. But of course, we can’t know when messages will be received, so we need a mechanism to iterate lazily over messages as they arrive. Async generators and async iteration let us do just that!</p>
<p><strong>TL;DR:</strong> generator functions are for data sources where the data consumer is in control, whereas async generators allow the data source itself to be in control.</p>
<h2 id="simpleexamplegenerateandconsumeanasyncgenerator">Simple Example: Generate and Consume an AsyncGenerator</h2>
<p>Let’s exercise our async chops with an example. We want to write an async generator function that repeatedly generates a new number after waiting a random number of milliseconds. Over a period of several seconds it might generate five or so numbers starting from 0. Let’s first write a helper function that generates a Promise to represent a timer:</p>
<pre><code class="language-javascript">// Create a Promise that resolves after ms time
var timer = function(ms) {
  return new Promise(resolve =&gt; {
    setTimeout(resolve, ms);
  });
};
</code></pre>
<p>Calling <code>timer(5000)</code> returns a Promise that will resolve in 5 seconds. Now we’re ready to write an async generator:</p>
<pre><code class="language-javascript">// Repeatedly generate a number starting
// from 0 after a random amount of time
var source = async function*() {
  var i = 0;
  while (true) {
    await timer(Math.random() * 1000);
    yield i++;
  }
};
</code></pre>
<p>So much complexity hiding behind such elegance! Our async generator function waits a random amount of time, then <code>yield</code>s the next number in the count-up. If we didn’t have async generators, we could try using a regular generator function to <code>yield</code> Promises like this:</p>
<pre><code class="language-javascript">var source = function*() {
  var i = 0;
  while (true) {
    yield timer(Math.random() * 1000)
      .then(() =&gt; i++);
  }
};
</code></pre>
<p>However, there are some edge cases and boilerplate we’d have to handle, so it’s nice to have a dedicated function type! Now we’re ready to write the consuming code; because we need the <code>await</code> operator, we’ll create an async <code>run()</code> function.</p>
<pre><code class="language-javascript">// Tie everything together
var run = async function() {
  var stream = source();
  for await (let n of stream) {
    console.log(n);
  }
};

run();
// =&gt; 0
// =&gt; 1
// =&gt; 2
// =&gt; 3
// ...
</code></pre>
<p>What magic, and in under 20 lines of code! First, we invoke the <code>source</code> async generator function, which returns a special <code>AsyncGenerator</code> object. Then we use the <code>for await...of</code> loop syntax—called “asynchronous iteration”—to loop over numbers one-by-one as <code>source</code> generates them.</p>
<p><strong>But we can level up:</strong> suppose we want to square the numbers generated by <code>source</code>. We could square directly inside the <code>for await...of</code> loop, but it’d be better to “transform” the stream of values outside the loop, similar to using <code>.map()</code> to transform an array of values. It’s quite straightforward:</p>
<pre><code class="language-javascript">// Return a new async iterator that applies a
// transform to the values from another async generator
var map = async function*(stream, transform) {
  for await (let n of stream) {
    yield transform(n);
  }
};
</code></pre>
<p>Then we just need to add a line to the <code>run()</code> function:</p>
<pre><code class="language-diff"> // Tie everything together
 var run = async function() {
   var stream = source();
+  // Square values generated by source() as they arrive
+  stream = map(stream, n =&gt; n * n);
   for await (let n of stream) {
     console.log(n);
   }
 };
</code></pre>
<p>Now when we <code>run()</code> everything:</p>
<pre><code class="language-javascript">// =&gt; 0
// =&gt; 1
// =&gt; 4
// =&gt; 9
// ...
</code></pre>
<p>Impressive! But perhaps generating counting numbers isn’t especially innovative.</p>
<h2 id="mediumexamplewriteanasynciteratorforwebsockets">Medium Example: Write an AsyncIterator for WebSockets</h2>
<p>The usual way to respond to incoming WebSocket messages is to attach an event listener:</p>
<pre><code class="language-javascript">var ws = new WebSocket('ws://localhost:3000/');
ws.addEventListener('message', event =&gt; {
  console.log(event.data);
});
</code></pre>
<p>But if we treated WebSocket messages as a stream, it seems natural to “iterate” over messages as they arrive. Unfortunately, WebSockets are not yet async iterable, but we can write our own polyfill in just a few lines. Here’s what our <code>run()</code> function will look like:</p>
<pre><code class="language-javascript">// Tie everything together
var run = async () =&gt; {
  var ws = new WebSocket('ws://localhost:3000/');
  for await (let message of ws) {
    console.log(message);
  }
};
</code></pre>
<p>Now for that polyfill. You may recall from <a href="/blog/generators-rick-astley-and-the-sequence-of-fibonacci/">Chris Aquino’s blog series</a> that, for an object to be iterable with the <code>for...of</code> loop, you must define the <code>Symbol.iterator</code> property on that object. Similarly, to make an object async iterable with the <code>for await...of</code> loop, its <code>Symbol.asyncIterator</code> property must be defined. Here’s an implementation:</p>
<pre><code class="language-javascript">// Add an async iterator to all WebSockets
WebSocket.prototype[Symbol.asyncIterator] = async function*() {
  while(this.readyState !== 3) {
    yield (await oncePromise(this, 'message')).data;
  }
};
</code></pre>
<p>This async iterator waits to receive a message, then <code>yield</code>s the <code>data</code> attribute of the WebSocket’s <code>MessageEvent</code>. The <code>oncePromise()</code> function is a bit of a hack: it returns a Promise that resolves when an event occurs, then immediately unsubscribes:</p>
<pre><code class="language-javascript">// Generate a Promise that listens only once for an event
var oncePromise = (emitter, event) =&gt; {
  return new Promise(resolve =&gt; {
    var handler = (...args) =&gt; {
      emitter.removeEventListener(event, handler);
      resolve(...args);
    };
    emitter.addEventListener(event, handler);
  });
};
</code></pre>
<p>It seems inefficient, but it really tidies up our async iterator. If you have a chatty WebSocket server running at <a href="http://localhost:3000">http://localhost:3000</a>, you can watch messages stream in by invoking <code>run()</code>:</p>
<pre><code class="language-javascript">run();
// =&gt; &quot;hello&quot;
// =&gt; &quot;sandwich&quot;
// =&gt; &quot;otters&quot;
// ...
</code></pre>
<h2 id="hardexamplerewriterxjs">Hard Example: Rewrite RxJS</h2>
<p>Now for the ultimate challenge. <a href="https://en.wikipedia.org/wiki/Functional_reactive_programming">Functional reactive programming</a> (FRP) is all the rage in UI programming, and in JavaScript, <a href="http://reactivex.io/rxjs/manual/overview.html">RxJS</a> is the most popular library for this programming style. RxJS models event sources as <code>Observable</code>s—they’re like an event stream or lazy array that can be modified with familiar array idioms like <code>map()</code> and <code>filter()</code>.</p>
<p>Since FRP complements JavaScript’s non-blocking philosophy, it’s possible an <a href="https://github.com/tc39/proposal-observable">RxJS-like API</a> will make it to a future version of JavaScript. Meantime, we can write our own RxJS clone with async generators in just 80 lines of code! Here’s the challenge:</p>
<ol>
<li>Listen for all click events</li>
<li>Filter down to only clicks on anchor tags</li>
<li>Only allow distinct clicks</li>
<li>Map from click events to a click counter and the click event</li>
<li>Throttle clicks to once every 500ms</li>
<li>Print the click counter and event</li>
</ol>
<p>This type of problem is right in RxJS’s wheelhouse, so we’ll try to replicate its approach. Here’s how we’ll exercise our implementation:</p>
<pre><code class="language-javascript">// Tie everything together
var run = async () =&gt; {
  var i = 0;
  var clicks = streamify('click', document.querySelector('body'));

  clicks = filter(clicks, e =&gt; e.target.matches('a'));
  clicks = distinct(clicks, e =&gt; e.target);
  clicks = map(clicks, e =&gt; [i++, e]);
  clicks = throttle(clicks, 500);

  subscribe(clicks, ([ id, click ]) =&gt; {
    console.log(id);
    console.log(click);
    click.preventDefault();
  });
};

run();
</code></pre>
<p>To make this work, we need to write six functions: <code>streamify()</code>, <code>filter()</code>, <code>distinct()</code>, <code>map()</code>, <code>throttle()</code> and <code>subscribe()</code>.</p>
<pre><code class="language-javascript">// Turn any event emitter into a stream
var streamify = async function*(event, element) {
  while (true) {
    yield await oncePromise(element, event);
  }
};
</code></pre>
<p><code>streamify()</code> is just like the WebSocket async iterator: <code>oncePromise()</code> uses <code>.addEventListener()</code> to listen once for an event, then resolves the Promise. By looping with <code>while (true)</code>, we can listen for events indefinitely.</p>
<pre><code class="language-javascript">// Only pass along events that meet a condition
var filter = async function*(stream, test) {
  for await (var event of stream) {
    if (test(event)) {
      yield event;
    }
  }
};
</code></pre>
<p><code>filter()</code> only <code>yield</code>s events that pass the test. <code>map()</code> is almost identical:</p>
<pre><code class="language-javascript">// Transform every event of the stream
var map = async function*(stream, transform) {
  for await (var event of stream) {
    yield transform(event);
  }
};
</code></pre>
<p>Instead of testing before yielding, <code>map()</code> simply transforms the event before yielding. <code>distinct()</code> shows one of the superpowers of async generators: they can persist state with local variables!</p>
<pre><code class="language-javascript">var identity = e =&gt; e;

// Only pass along events that differ from the last one
var distinct = async function*(stream, extract = identity) {
  var lastVal;
  var thisVal;
  for await (var event of stream) {
    thisVal = extract(event);
    if (thisVal !== lastVal) {
      lastVal = thisVal;
      yield event;
    }
  }
};
</code></pre>
<p>Last, the mighty <code>throttle()</code> function resembles <code>distinct()</code>: it tracks the timestamp of the last event and only <code>yield</code>s it if a certain amount of time has passed since the last <code>yield</code>ed event.</p>
<pre><code class="language-javascript">// Only pass along event if some time has passed since the last one
var throttle = async function*(stream, delay) {
  var lastTime;
  var thisTime;
  for await (var event of stream) {
    thisTime = (new Date()).getTime();
    if (!lastTime || thisTime - lastTime &gt; delay) {
      lastTime = thisTime;
      yield event;
    }
  }
};
</code></pre>
<p>Finally, we need to print out the click event and counter for every event that made it this far. <code>subscribe()</code> is trivial: it just loops over every event and runs the callback, no <code>yield</code>s necessary.</p>
<pre><code class="language-javascript">// Invoke a callback every time an event arrives
var subscribe = async (stream, callback) =&gt; {
  for await (var event of stream) {
    callback(event);
  }
};
</code></pre>
<p>And with that, we’ve written our own functional reactive pipeline!</p>
<p><a href="https://gist.github.com/nybblr/3af62797052c42f7090b4f8614b5e157">Check out the gist</a> if you want to try out any of these examples.</p>
<h2 id="challenges">Challenges</h2>
<p>Async generators are pretty awesome. Whereas generator functions allow us to pull data out of an iterator, async generators let us iterate over data that is “pushed” to us. They’re a great abstraction for asynchronous data structures. However, there are some caveats.</p>
<p>First, implementing support for the <code>for await...of</code> on objects is a bit gnarly unless you avoid <code>yield</code> and <code>await</code>. Notably, converting anything with <code>.addEventListener()</code> is tricky because you can’t use the <code>yield</code> operator within the callback:</p>
<pre><code class="language-javascript">var streamify = async function*(event, element) {
  element.addEventListener(event, e =&gt; {
    // This doesn't work because yield is being
    // called from inside another function.
    yield e;
  });
};
</code></pre>
<p>Similarly, you can’t use <code>yield</code> within <code>.forEach()</code> or other functional methods. This is an inherent limitation since there’s no guarantee <code>yield</code> won’t be used <em>after</em> the generator has already finished.</p>
<p>To sidestep this, we wrote the <code>oncePromise()</code> helper. Apart from potential performance issues, it’s important to note that Promise callbacks always execute after the current callstack has finished. In browsers that run Promise callbacks as <a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/">microtasks</a>, this shouldn’t cause issues, but some Promise polyfills won’t run the callbacks until the next run of the event loop. Consequently, invoking the <code>.preventDefault()</code> method may have no effect since the DOM event may have already bubbled to the browser.</p>
<p>JavaScript now has several asynchronous stream datatypes: <code>Stream</code>, <code>AsyncGenerator</code> and eventually <code>Observable</code>. While all three fall into the continuum of “pushed” data sources, there are subtle semantic differences in how they handle back pressure and control the underlying resource. If you’re interested in the finer facets of functional reactive semantics, check out the <a href="https://github.com/kriskowal/gtor">General Theory of Reactivity</a>.</p>
<h2 id="moretocome">More to Come</h2>
<p>In the arms race for language features, JavaScript is no slacker. Destructuring in ES2015, async functions in ES2016, and now async iteration enable JavaScript to elegantly tackle the complexities of UI and I/O programming without resorting to the usual unpredictability of multi-threading.</p>
<p>And there’s much more to come! So keep an eye on the blog and the <a href="https://github.com/tc39/proposals">TC39 proposals repo</a> for new goodies. Meantime, you can start using async generator functions in your own code by <a href="https://babeljs.io/repl/#?presets=stage-3">enabling Stage 3 proposals in Babel</a>.</p>
<!--kg-card-end: markdown--><!--kg-card-end: markdown-->
            </div>
          </div>
        </div>
        <section class="m-subscribe-section">
          <div class="l-wrapper in-post">
            <div class="m-subscribe-section__content">
              <div class="m-subscribe-section__text">
                <h4 class="m-subscribe-section__title">Subscribe to our newsletter</h4>
                <p class="m-subscribe-section__description">
                  Get the latest posts delivered right to your inbox.
                </p>
              </div>
              <div class="m-subscribe-section__form">
                
<form method="post" action="https://jonathanleemartin.us4.list-manage.com/subscribe/post?u=06192382d0d99bb3a3f789d30&amp;id=cb60b1e5bb" id="subscribe-form" class="m-subscribe-section__form">
  <input class="confirm" type="hidden" name="confirm"  /><input class="location" type="hidden" name="location"  /><input class="referrer" type="hidden" name="referrer"  />

  <fieldset>
    <label for="EMAIL" class="sr-only">Your email address</label>
    <input id="EMAIL" name="EMAIL" class="m-input in-subscribe-section" placeholder="Your email address" value="" >
  </fieldset>
  <button id="subscribe_button" class="m-button primary block" type="submit">Subscribe</button>

  
<script>
    (function(g,h,o,s,t){
        var buster = function(b,m) {
            h[o]('input.'+b).forEach(function (i) {
                i.value=i.value || m;
            });
        };
        buster('location', g.location.href);
        buster('referrer', h.referrer);
    })(window,document,'querySelectorAll','value');
</script>


</form>

              </div>
            </div>
          </div>
        </section>
        <section class="m-author">
          <div class="m-author__content">
            <div class="m-author__picture">
              <a href="/author/jonathan/" class="m-author-picture" aria-label="Author picture">
                <div style="background-image: url(//www.gravatar.com/avatar/6dc50195bf39376a9154e48d6b5df778?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x);"></div>
              </a>
            </div>
            <div class="m-author__info">
              <h4 class="m-author__name">
                <a href="/author/jonathan/">Jonathan Lee Martin</a>
              </h4>
              <p class="m-author__bio">Jonathan is an educator, writer and international speaker. He guides developers — from career switchers to senior developers at Fortune 100 companies — through their journey into web development.</p>
              <ul class="m-author-links">
                <li>
                  <a href="https://jonathanleemartin.com/" target="_blank" rel="noopener" aria-label="Website">
                    <span class="icon-globe"></span>
                  </a>
                </li>
                <li>
                  <a href="https://facebook.com/yellowscale" target="_blank" rel="noopener" aria-label="Facebook">
                    <span class="icon-facebook"></span>
                  </a>
                </li>
                <li>
                  <a href="https://twitter.com/nybblr" target="_blank" rel="noopener" aria-label="Twitter">
                    <span class="icon-twitter"></span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </section>
        <section class="m-recommended">
          <div class="l-wrapper in-recommended">
            <h3 class="m-section-title in-recommended">Recommended for you</h3>
            <div class="m-recommended-articles">
              <div class="m-recommended-slider js-recommended-articles">
                
    <div class="m-recommended-slider__item">
    <article class="m-article-card no-picture post tag-react tag-javascript featured">
      <div class="m-article-card__picture">
      <a href="/blog/dont-over-react/" class="m-article-card__picture-link" aria-label="Article"></a>
      <a href="/author/jonathan/" class="m-article-card__author js-tooltip" aria-label="Authors" data-tippy-content="Posted by Jonathan Lee Martin ">
          <div style="background-image: url(//www.gravatar.com/avatar/6dc50195bf39376a9154e48d6b5df778?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x);"></div>
      </a>
        <a href="/blog/dont-over-react/" class="m-article-card__featured js-tooltip" data-tippy-content="Featured" aria-label="Article">
          <span class="icon-star"></span>
        </a>
    </div>
      <div class="m-article-card__info">
        <a href="/tag/react/" class="m-article-card__tag">React</a>
      <a href="/blog/dont-over-react/" class="m-article-card__info-link">
        <div class="m-article-card__excerpt">
          <h2 class="m-article-card__title">Don’t Over React! Render Binary Data with Class.</h2>
          <p class="m-article-card__description">Eventually, your React web app will accept file uploads. JavaScript has exceptional APIs for handling chunks of binary data, but the interaction with React can cause some major performance hiccups. Discover the performance implications of 5 different ways to work with user-submitted binary data!</p>
        </div>
        <div class="m-article-card__timestamp">
          <span>December 5, 2017</span>
          <span>&bull;</span>
          <span>7 min read</span>
        </div>
      </a>
    </div>
  </article>
    </div>
    <div class="m-recommended-slider__item">
    <article class="m-article-card no-picture post tag-react tag-javascript">
      <div class="m-article-card__picture">
      <a href="/blog/destroy-all-classes-turn-react-components-inside-out-with-functional-programming/" class="m-article-card__picture-link" aria-label="Article"></a>
      <a href="/author/jonathan/" class="m-article-card__author js-tooltip" aria-label="Authors" data-tippy-content="Posted by Jonathan Lee Martin ">
          <div style="background-image: url(//www.gravatar.com/avatar/6dc50195bf39376a9154e48d6b5df778?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x);"></div>
      </a>
    </div>
      <div class="m-article-card__info">
        <a href="/tag/react/" class="m-article-card__tag">React</a>
      <a href="/blog/destroy-all-classes-turn-react-components-inside-out-with-functional-programming/" class="m-article-card__info-link">
        <div class="m-article-card__excerpt">
          <h2 class="m-article-card__title">DESTROY ALL CLASSES: Turn React Components Inside Out with Functional Programming</h2>
          <p class="m-article-card__description">With React's stateless functional components you can create ambitious apps that are 98% plain ol' JavaScript. In this real-world example, we'll use functional programming and higher-order components to turn class-based React Components into stateless functional components.</p>
        </div>
        <div class="m-article-card__timestamp">
          <span>July 19, 2017</span>
          <span>&bull;</span>
          <span>10 min read</span>
        </div>
      </a>
    </div>
  </article>
    </div>
    <div class="m-recommended-slider__item">
    <article class="m-article-card no-picture post tag-javascript tag-node">
      <div class="m-article-card__picture">
      <a href="/blog/hi-im-node-js-and-ill-be-your-server-today/" class="m-article-card__picture-link" aria-label="Article"></a>
      <a href="/author/jonathan/" class="m-article-card__author js-tooltip" aria-label="Authors" data-tippy-content="Posted by Jonathan Lee Martin ">
          <div style="background-image: url(//www.gravatar.com/avatar/6dc50195bf39376a9154e48d6b5df778?s&#x3D;250&amp;d&#x3D;mm&amp;r&#x3D;x);"></div>
      </a>
    </div>
      <div class="m-article-card__info">
        <a href="/tag/javascript/" class="m-article-card__tag">JavaScript</a>
      <a href="/blog/hi-im-node-js-and-ill-be-your-server-today/" class="m-article-card__info-link">
        <div class="m-article-card__excerpt">
          <h2 class="m-article-card__title">Hi, I’m Node.js and I’ll be your server today.</h2>
          <p class="m-article-card__description">Tech stack decisions can be hard. Is Node.js the right choice for your service? Have a seat and your server will be right with you.</p>
        </div>
        <div class="m-article-card__timestamp">
          <span>April 12, 2017</span>
          <span>&bull;</span>
          <span>7 min read</span>
        </div>
      </a>
    </div>
  </article>
    </div>
              </div>
            </div>
          </div>
        </section>
      </div>
    </article>
  </main>
</div>



    
<div class="m-search js-search">
  <button class="m-icon-button outlined as-close-search js-close-search" aria-label="Close search">
    <span class="icon-close"></span>
  </button>
  <div class="m-search__content">
    <form class="m-search__form">
      <fieldset>
        <span class="icon-search m-search-icon"></span>
        <input type="text" class="m-input in-search js-input-search" placeholder="Type to search" aria-label="Type to search">
      </fieldset>
    </form>
    <div class="js-search-results"></div>
  </div>
</div>

    
<footer class="m-footer">
  <div class="m-footer__content">
    <p class="m-footer-copyright">
      <span>tl;dr &copy; 2019</span>
      <span>&nbsp; &bull; &nbsp;</span>
      <span>By <a href="https://jonathanleemartin.com/" target="_blank" rel="noopener">Jonathan Lee Martin</a></span>
    </p>
    <nav class="m-footer-social">
        <a href="https://www.facebook.com/yellowscale" target="_blank" rel="noopener" aria-label="Facebook">
          <span class="icon-facebook"></span>
        </a>
        <a href="https://twitter.com/nybblr" target="_blank" rel="noopener" aria-label="Twitter">
          <span class="icon-twitter"></span>
        </a>
    </nav>
  </div>
</footer>

    <script defer src="/assets/js/manifest.js"></script>
    <script defer src="/assets/js/polyfill.js"></script>
    <script defer src="/assets/js/vendor.js"></script>
    <script defer src="/assets/js/app.js"></script>

      <script defer src="/assets/js/post.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/plugins/autoloader/prism-autoloader.min.js"></script>
  <script>Prism.plugins.autoloader.languages_path = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/components/';</script>


    
  </body>
</html>
